<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title>EM-Aide</title>
    <style>
      body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; margin: 24px; }
      .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
      .card { border: 1px solid #e5e7eb; border-radius: 12px; padding: 16px; }
      .muted { color: #6b7280; }
      pre { background: #0b1020; color: #d1d5db; padding: 12px; border-radius: 12px; overflow: auto; max-height: 420px; }
      button { padding: 10px 14px; border-radius: 10px; border: 1px solid #111827; background: #111827; color: white; cursor: pointer; }
      button.secondary { background: white; color: #111827; }
      .row { display:flex; gap: 10px; align-items:center; flex-wrap: wrap;}
      table { width: 100%; border-collapse: collapse; }
      td, th { padding: 8px; border-bottom: 1px solid #e5e7eb; text-align: left; }
      code { background: #f3f4f6; padding: 2px 6px; border-radius: 6px; }
    </style>
  </head>
  <body>
    <h1>EM-Aide</h1>
    <p class="muted">Local metrics + sanitized agentic planning (Option B). No ticket text or code leaves this machine.</p>

    {% if team %}
    <div class="row">
      <button class="secondary" onclick="post('/teams/{{team.id}}/metrics/snapshot')">Snapshot metrics</button>
      <button onclick="post('/teams/{{team.id}}/plan/run')">Run weekly plan</button>
      <a href="/runs" class="muted">View agent runs</a>
    </div>
    {% else %}
      <p>No team configured.</p>
    {% endif %}

    <div class="grid" style="margin-top: 14px;">
      <div class="card">
        <h3>Latest metrics</h3>
        {% if metrics and metrics|length > 0 %}
        <table>
          <thead><tr><th>Metric</th><th>Value</th><th>Date</th></tr></thead>
          <tbody>
            {% for m in metrics %}
              <tr><td><code>{{m.name}}</code></td><td>{{"%.3f"|format(m.value)}}</td><td>{{m.as_of_date}}</td></tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
          <p class="muted">No metrics yet. Click “Snapshot metrics”.</p>
        {% endif %}
      </div>

      <div class="card">
        <h3>Latest weekly plan</h3>
        {% if latest_plan_json %}
          <pre id="plan">{{ latest_plan_json }}</pre>
        {% else %}
          <p class="muted">No plan yet. Click “Run weekly plan”.</p>
        {% endif %}
      </div>
    </div>

    <script>
      async function post(path) {
        const res = await fetch(path, {method: "POST"});
        const data = await res.json();
        alert(JSON.stringify(data, null, 2));
        window.location.reload();
      }
    </script>
  </body>
</html>
